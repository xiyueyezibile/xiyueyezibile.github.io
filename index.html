<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>汐月也自闭了的个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="1">
<meta property="og:type" content="website">
<meta property="og:title" content="汐月也自闭了的个人博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="汐月也自闭了的个人博客">
<meta property="og:description" content="1">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="xiyueyezibile">
<meta property="article:tag" content="xiyueyezibile">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="汐月也自闭了的个人博客" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">汐月也自闭了的个人博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">1</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-函数防抖与函数节流" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/04/%E5%87%BD%E6%95%B0%E9%98%B2%E6%8A%96%E4%B8%8E%E5%87%BD%E6%95%B0%E8%8A%82%E6%B5%81/" class="article-date">
  <time class="dt-published" datetime="2023-05-04T12:49:24.304Z" itemprop="datePublished">2023-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/04/%E5%87%BD%E6%95%B0%E9%98%B2%E6%8A%96%E4%B8%8E%E5%87%BD%E6%95%B0%E8%8A%82%E6%B5%81/">函数防抖与函数节流</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>作用：</strong>函数节流和函数防抖两个都是优化高频率执行js代码的一种手段。</p>
<h2 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h2><p><strong>函数节流：</strong>在一定时间内js方法只跑一次(比如人的眨眼睛，就是一定时间内眨一次)。这是函数节流最形象的解释;<br><strong>函数防抖：</strong>指频繁触发的情况下，只有足够的空闲时间，才执行代码一次(比如生活中的坐公交，就是一定时间内，如果有人陆续刷卡上车，司机就不会开车。只有别人没刷卡了，司机才开车)；</p>
<h2 id="防抖函数的实现"><a href="#防抖函数的实现" class="headerlink" title="防抖函数的实现"></a>防抖函数的实现</h2><p>核心逻辑：下一次防抖函数的调用会清除上一次防抖函数调用所启用的定时器，</p>
<p>​					所以只有留出一定的时间才会执行该代码一次，在定时器里面调用函数</p>
<h3 id="非立即执行"><a href="#非立即执行" class="headerlink" title="非立即执行"></a>非立即执行</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 防抖函数，非立即执行版本</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">AntiShake</span> (fn,time = <span class="number">50</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;<span class="comment">// args是fn里面的参数</span></span><br><span class="line">        <span class="built_in">clearTimeout</span>(timer)<span class="comment">// 清除之前的定时器</span></span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>,args)<span class="comment">// 通过apply方法保证fn里面的this指向自身</span></span><br><span class="line">     &#125;,time)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="立即执行"><a href="#立即执行" class="headerlink" title="立即执行"></a>立即执行</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 防抖函数，立即执行版本</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait = <span class="number">50</span></span>) &#123;</span><br><span class="line">	<span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">	<span class="keyword">let</span> flag = <span class="literal">true</span><span class="comment">// 判断是否执行</span></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line"> 		<span class="built_in">clearTimeout</span>(timer);</span><br><span class="line"> 		<span class="keyword">if</span>(flag) &#123;</span><br><span class="line"> 			func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, ...args);<span class="comment">// 第一次，立即执行一次</span></span><br><span class="line"> 			flag = <span class="literal">false</span></span><br><span class="line"> 		&#125;</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">			flag = <span class="literal">true</span></span><br><span class="line">		&#125;, wait);</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 防抖函数，合并版本</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait = <span class="number">50</span>,immediate</span>) &#123;</span><br><span class="line">	<span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line"> 		<span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">        <span class="keyword">const</span> callNow = !timer;<span class="comment">//如果有定时器就不执行，如果没有就代表是第一次则立即执行</span></span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">			timer = <span class="literal">null</span></span><br><span class="line">		&#125;, wait);</span><br><span class="line">		<span class="keyword">if</span>(immediate) &#123;<span class="comment">//是否立即执行</span></span><br><span class="line">			<span class="keyword">if</span> (callNow) func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, ...args);<span class="comment">//第一次，立即执行一次</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="节流函数的实现"><a href="#节流函数的实现" class="headerlink" title="节流函数的实现"></a>节流函数的实现</h2><p>核心逻辑：如果定时器为空就开启定时器，定时器里执行函数并且置空<br>                    定时器不为空的时候就会跳过执行，直到被置空</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, wait = <span class="number">50</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timeout = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果定时器为空就开启定时器，定时器里执行函数并且置空</span></span><br><span class="line">    <span class="comment">// 定时器不为空的时候就会跳过执行，直到被置空</span></span><br><span class="line">        <span class="keyword">if</span> (!timeout) &#123;</span><br><span class="line">            timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                timeout = <span class="literal">null</span>;</span><br><span class="line">                func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">            &#125;, wait)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_57142556/article/details/118002289?ops_request_misc=&request_id=&biz_id=102&utm_term=%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%E5%87%BD%E6%95%B0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118002289.nonecase&spm=1018.2226.3001.4187">csdn</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6958704784626941982">juejin</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41996454/article/details/109783564">csdn2</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/04/%E5%87%BD%E6%95%B0%E9%98%B2%E6%8A%96%E4%B8%8E%E5%87%BD%E6%95%B0%E8%8A%82%E6%B5%81/" data-id="clh94rs5a0009o8gt3sbj521k" data-title="函数防抖与函数节流" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-关于函数闭包的理解" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/04/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E9%97%AD%E5%8C%85%E7%9A%84%E7%90%86%E8%A7%A3/" class="article-date">
  <time class="dt-published" datetime="2023-05-04T12:49:24.300Z" itemprop="datePublished">2023-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/04/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E9%97%AD%E5%8C%85%E7%9A%84%E7%90%86%E8%A7%A3/">关于函数闭包的理解</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>当一个函数的返回值是另外一个函数，而返回的那个函数如果调用了其父函数内部的其它变量，如果返回的这个函数在外部被执行，就产生了闭包</p>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><p>避免全局变量被污染,利于代码封装，可以在内存中维护一个变量</p>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><p>闭包会常驻内存，容易造成内存泄漏</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function outerfn() &#123;</span><br><span class="line">	let a = 0</span><br><span class="line">	let b = 0</span><br><span class="line">	return function innerfn() &#123;</span><br><span class="line">	alert(a)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">const fn = outerfn()</span><br><span class="line">fn()</span><br><span class="line">//虽然b没有被使用，但依然存在于内存之中</span><br></pre></td></tr></table></figure>

<p><strong>内存泄漏</strong>：内存泄漏是指由于疏忽或错误造成程序未能释放已经不在使用的内存</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39903567/article/details/115010640?spm=1001.2101.3001.6650.17&utm_medium=distribute.pc_relevant.none-task-blog-2~default~OPENSEARCH~Rate-17-115010640-blog-129245907.pc_relevant_3mothn_strategy_and_data_recovery&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~OPENSEARCH~Rate-17-115010640-blog-129245907.pc_relevant_3mothn_strategy_and_data_recovery&utm_relevant_index=18">csdn闭包</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44865458/article/details/116232112?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167773410516800197079952%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=167773410516800197079952&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-1-116232112-null-null.142%5Ev73%5Epc_search_v2,201%5Ev4%5Eadd_ask,239%5Ev2%5Einsert_chatgpt&utm_term=js%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F&spm=1018.2226.3001.4187">csdn内存泄漏</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/04/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E9%97%AD%E5%8C%85%E7%9A%84%E7%90%86%E8%A7%A3/" data-id="clh94rs590008o8gtgx2e7u4w" data-title="关于函数闭包的理解" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-js开启摄像头" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/04/js%E5%BC%80%E5%90%AF%E6%91%84%E5%83%8F%E5%A4%B4/" class="article-date">
  <time class="dt-published" datetime="2023-05-04T12:49:24.296Z" itemprop="datePublished">2023-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/04/js%E5%BC%80%E5%90%AF%E6%91%84%E5%83%8F%E5%A4%B4/">js开启摄像头</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="所需知识"><a href="#所需知识" class="headerlink" title="所需知识"></a>所需知识</h2><h3 id="canvas-drawImage"><a href="#canvas-drawImage" class="headerlink" title="canvas drawImage"></a>canvas drawImage</h3><p><code>drawImage(image，sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)</code></p>
<p>1、<code>image</code>：image是画布绘制的图像源，绘制到画布上的元素，可以是canvasElement,imageElement,svgImageElement ,videoElement等一系列具有图像的元素。</p>
<p>2、<code>sx</code>：绘制裁剪的图像源的x 坐标位置；</p>
<p>3、<code>sy</code>：绘制裁剪的图像源的y坐标位置；</p>
<p>4、<code>sWidth</code>：绘制裁剪的图像源的宽度；</p>
<p>5、<code>sHeight</code>：绘制裁剪的图像源的高度；</p>
<p>6、<code>dx</code>：目标源在canvas画布上绘制的左上角的x坐标；</p>
<p>7、<code>dy</code>：目标源在canvas画布上绘制的左上角的y坐标；</p>
<p>8、<code>dWidth</code>：目标源在canvas画布上绘制的宽度，会自动根据图像源截取的宽度对比做缩放；</p>
<p>9、<code>dWidth</code>：目标源在canvas画布上绘制的高度，会自动根据图像源截取的高度对比做缩放；</p>
<h3 id="requestAnimationFrame绘制函数"><a href="#requestAnimationFrame绘制函数" class="headerlink" title="requestAnimationFrame绘制函数"></a>requestAnimationFrame绘制函数</h3><p><code>window.requestAnimationFrame() </code>告诉浏览器——你希望执行一个动画，并且要求<strong>浏览器在下次重绘之前调用指定的回调函数更新动画</strong>。</p>
<h3 id="MediaDevices-getUserMedia"><a href="#MediaDevices-getUserMedia" class="headerlink" title="MediaDevices.getUserMedia()"></a>MediaDevices.getUserMedia()</h3><p>它返回一个 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> 对象，成功后会<code>resolve</code>回调一个 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaStream"><code>MediaStream</code></a> 对象。若用户拒绝了使用权限，或者需要的媒体源不可用，<code>promise</code>会<code>reject</code>回调一个 <code>PermissionDeniedError</code> 或者 <code>NotFoundError</code> 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(constraints)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">stream</span>) &#123;</span><br><span class="line">  <span class="comment">/* 使用这个 stream stream */</span></span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="comment">/* 处理 error */</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//constraints 作为一个MediaStreamConstraints (en-US) 对象，指定了请求的媒体类型和相对应的参数。</span></span><br><span class="line">&#123; <span class="attr">audio</span>: <span class="literal">true</span>, <span class="attr">video</span>: <span class="literal">true</span> &#125; or</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">audio</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">video</span>: &#123; <span class="attr">width</span>: <span class="number">1280</span>, <span class="attr">height</span>: <span class="number">720</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="srcObject"><a href="#srcObject" class="headerlink" title="srcObject"></a>srcObject</h3><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement"><code>HTMLMediaElement</code></a> 接口的 <strong><code>srcObject</code></strong> 属性设定或返回一个对象，这个对象提供了一个与<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement"><code>HTMLMediaElement</code></a>关联的媒体源，这个对象通常是 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaStream"><code>MediaStream</code></a> ，但根据规范可以是 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaSource"><code>MediaSource</code></a>， <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob"><code>Blob</code></a> 或者 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/File"><code>File</code></a>。</p>
<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">video</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">canvas</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">video</span> <span class="attr">autoplay</span> <span class="attr">id</span>=<span class="string">&#x27;video&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;output&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> video = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;video&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> back = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;output&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//console.log(back,video)</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> backcontext = back.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">try</span>&#123;</span></span><br><span class="line"><span class="language-javascript">         backcontext.<span class="title function_">drawImage</span>(video,<span class="number">0</span>,<span class="number">0</span>,back.<span class="property">width</span>,back.<span class="property">height</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;<span class="keyword">catch</span>(e)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(e.<span class="property">name</span> == <span class="string">&quot;NS_ERROR_NOT_AVAILABLE&quot;</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="built_in">setInterval</span>(draw,<span class="number">200</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">throw</span> e</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">       <span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(draw)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> success = <span class="keyword">function</span>(<span class="params">stream</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;摄像头开启成功&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(stream);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//视频流赋值</span></span></span><br><span class="line"><span class="language-javascript">		video.<span class="property">srcObject</span> = stream</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">draw</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> <span class="title function_">error</span> = (<span class="params">error</span>)=&gt;&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(<span class="string">&#x27;调用失败&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123;<span class="attr">video</span>:<span class="literal">true</span>,<span class="attr">audio</span>:<span class="literal">false</span>&#125;).<span class="title function_">then</span>(success).<span class="title function_">catch</span>(error)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/04/js%E5%BC%80%E5%90%AF%E6%91%84%E5%83%8F%E5%A4%B4/" data-id="clh94rs570005o8gtdpz8heev" data-title="js开启摄像头" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-JS Set使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/04/JS%20Set%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2023-05-04T12:49:24.291Z" itemprop="datePublished">2023-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/04/JS%20Set%E4%BD%BF%E7%94%A8/">JS Set使用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Set类似与Array数组，但Set里面的元素不能重复</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">10</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set)<span class="comment">//10 12 14</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> array = [<span class="number">10</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array)<span class="comment">//10 10 12 14</span></span><br></pre></td></tr></table></figure>

<p>除了new时初始化元素，也可以通过add添加元素</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式一：创建Set对象，使用add方法添加元素</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> obj = &#123;<span class="attr">name</span>: <span class="string">&quot;aaa&quot;</span>&#125;</span><br><span class="line"><span class="keyword">const</span> set1 = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">set1.<span class="title function_">add</span>(<span class="number">10</span>)</span><br><span class="line">set1.<span class="title function_">add</span>(<span class="number">10</span>)</span><br><span class="line">set1.<span class="title function_">add</span>(<span class="number">12</span>)</span><br><span class="line">set1.<span class="title function_">add</span>(<span class="number">14</span>)</span><br><span class="line">set1.<span class="title function_">add</span>(obj)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set1)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 方式二： 直接添加元素</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> set2 = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">10</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, &#123;<span class="attr">name</span>: <span class="string">&quot;zzz&quot;</span>&#125;])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set2)</span><br></pre></td></tr></table></figure>

<h2 id="Set方法数组去重"><a href="#Set方法数组去重" class="headerlink" title="Set方法数组去重"></a>Set方法数组去重</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="number">10</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">17</span>]</span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(array)</span><br><span class="line"><span class="comment">//Array.from把伪数组转换为数组</span></span><br><span class="line"><span class="keyword">const</span> newArray = <span class="title class_">Array</span>.<span class="title function_">from</span>(set)</span><br><span class="line"><span class="keyword">const</span> newArray1 = [...set]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set)<span class="comment">//Set(4) 10 12 15 17</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newArray)<span class="comment">//10 12 15 17</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newArray1)<span class="comment">//10 12 15 17</span></span><br></pre></td></tr></table></figure>

<h2 id="Set常见的属性："><a href="#Set常见的属性：" class="headerlink" title="Set常见的属性："></a>Set常见的属性：</h2><p><strong>size：</strong>返回Set中元素的个数；</p>
<h2 id="Set常用的方法："><a href="#Set常用的方法：" class="headerlink" title="Set常用的方法："></a>Set常用的方法：</h2><p><strong>add(value)：</strong>添加某个元素，返回Set对象本身；</p>
<p><strong>delete(value)：</strong>从set中删除和这个值相等的元素，返回boolean类型；</p>
<p><strong>has(value)：</strong>判断set中是否存在某个元素，返回boolean类型；</p>
<p><strong>clear()：</strong>清空set中所有的元素，没有返回值；</p>
<p><strong>forEach(callback, [, thisArg])：</strong>通过forEach遍历set；</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/04/JS%20Set%E4%BD%BF%E7%94%A8/" data-id="clh94rs550003o8gtaaqp5bya" data-title="JS Set使用" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-call,bind,apply" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/04/call,bind,apply/" class="article-date">
  <time class="dt-published" datetime="2023-05-04T12:49:24.288Z" itemprop="datePublished">2023-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/04/call,bind,apply/">call,bind,apply</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//手写call方法</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myCall</span> = <span class="keyword">function</span> (<span class="params">obj,...rest</span>) &#123;</span><br><span class="line">  <span class="comment">//判断是否为null或undefined</span></span><br><span class="line">  <span class="comment">//call第一个参数为这些时指向全局对象</span></span><br><span class="line">  <span class="keyword">if</span>(obj == <span class="literal">undefined</span> || obj == <span class="literal">null</span>) &#123;</span><br><span class="line">    obj = <span class="variable language_">window</span></span><br><span class="line">  &#125;</span><br><span class="line">  obj.<span class="property">fng</span> = <span class="variable language_">this</span><span class="comment">//谁调用this，this就指向谁</span></span><br><span class="line">  <span class="keyword">let</span> result = obj.<span class="title function_">fng</span>(...rest)<span class="comment">//立即执行</span></span><br><span class="line">  <span class="keyword">delete</span> obj.<span class="property">fng</span><span class="comment">//删除防止越来越多</span></span><br><span class="line">  <span class="keyword">return</span> result<span class="comment">//返回执行的结果</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&quot;一个&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fng</span>(<span class="params">a,b</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;我是&#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + a + b);</span><br><span class="line">&#125;</span><br><span class="line">fng.<span class="title function_">myCall</span>(obj,<span class="string">&quot;好&quot;</span>,<span class="string">&quot;前端&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//手写apply方法</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myApply</span> = <span class="keyword">function</span> (<span class="params">obj,arr</span>) &#123;</span><br><span class="line">  <span class="comment">//判断是否为null或undefined</span></span><br><span class="line">  <span class="comment">//apply第一个参数为这些时指向全局对象</span></span><br><span class="line">  <span class="keyword">if</span>(obj == <span class="literal">undefined</span> || obj == <span class="literal">null</span>) &#123;</span><br><span class="line">    obj = <span class="variable language_">window</span></span><br><span class="line">  &#125;</span><br><span class="line">  obj.<span class="property">fng</span> = <span class="variable language_">this</span><span class="comment">//谁调用this指向谁</span></span><br><span class="line">  <span class="keyword">let</span> result = obj.<span class="title function_">fng</span>(...arr)<span class="comment">//立即执行函数</span></span><br><span class="line">  <span class="keyword">delete</span> obj.<span class="property">fng</span><span class="comment">//删除防止越来越多</span></span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line">fng.<span class="title function_">myApply</span>(obj,[<span class="string">&quot;牛逼的&quot;</span>,<span class="string">&quot;前端&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">//手写bind方法</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myBind</span> = <span class="keyword">function</span> (<span class="params">obj,...rest</span>) &#123;</span><br><span class="line">  <span class="comment">//判断是否为null或undefined</span></span><br><span class="line">  <span class="comment">//bind第一个参数为这些时指向全局对象</span></span><br><span class="line">  <span class="keyword">if</span>(obj == <span class="literal">undefined</span> || obj == <span class="literal">null</span>) &#123;</span><br><span class="line">    obj = <span class="variable language_">window</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> _this = <span class="variable language_">this</span><span class="comment">//谁调用this指向谁</span></span><br><span class="line">  <span class="comment">//1.返回一个函数，不会立即执行</span></span><br><span class="line">  <span class="comment">//2.函数的返回值里面调用call方法，当调用时就会执行更改this指向</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...otherrest</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> _this.<span class="title function_">call</span>(obj,...rest,...otherrest)<span class="comment">//执行时改变其this指向</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> s = fng.<span class="title function_">myBind</span>(obj,<span class="string">&quot;厉害的&quot;</span>)</span><br><span class="line"><span class="title function_">s</span>(<span class="string">&quot;前端&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  总结：call方法和bind方法非常相似，在Function上定义方法不要用箭头函数</span></span><br><span class="line"><span class="comment">        箭头函数导致this指向不会变，手写实现this指向改变都是把调用函数</span></span><br><span class="line"><span class="comment">        变成改变this指向的对象下面的一个方法，然后在删除</span></span><br><span class="line"><span class="comment">        而bind较不一样，要返回一个改变this指向的函数，通过前两种方法设置</span></span><br><span class="line"><span class="comment">        返回函数的返回值this指向改变去实现bind方法</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/04/call,bind,apply/" data-id="clh94rs530001o8gt906bfhj9" data-title="call,bind,apply" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-base64转文件" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/04/base64%E8%BD%AC%E6%96%87%E4%BB%B6/" class="article-date">
  <time class="dt-published" datetime="2023-05-04T12:49:24.284Z" itemprop="datePublished">2023-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/04/base64%E8%BD%AC%E6%96%87%E4%BB%B6/">base64转文件</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="所需知识"><a href="#所需知识" class="headerlink" title="所需知识"></a>所需知识</h2><h3 id="match方法"><a href="#match方法" class="headerlink" title="match方法"></a>match方法</h3><p>match本身是JavaScript语言中字符串对象的一个方法，该方法的签名是  match([string] | [RegExp])</p>
<p>它的参数既可以是一个字符串，也可以是一个正则表达式。该方法绝大多数都是要使用正则表达式的，所以参数为string的情况不在本文讨论范围之内。其实参数即使是一个简单的string，其返回值也跟使用正则表达式的结果无异，而且使用正则表达式的变化比较多，用法复杂，所以我们只讨论正则的用法。</p>
<p>JavaScript中的match()方法的返回值是数组或者是null。如果原字符串中匹配到了正则表达式指代的子串，则返回一个数组，否则返回null。</p>
<h3 id="window-atob-base64"><a href="#window-atob-base64" class="headerlink" title="window.atob(base64)"></a>window.atob(base64)</h3><p>用来解码一个已经被base-64编码过的数据</p>
<h3 id="charCodeAt-index"><a href="#charCodeAt-index" class="headerlink" title="charCodeAt(index)"></a>charCodeAt(index)</h3><p>在 JavaScript 中，charCodeAt() 是一种字符串方法，用于检索字符串中特定位置的字符的Unicode 值。因为 charCodeAt() 方法是 String 对象的方法，所以必须通过 String 类的特定实例调用它。</p>
<p>charCodeAt() 方法返回一个 UTF-16 值（一个介于 0 和 65535 之间的 16 位整数），它是字符串中特定位置的字符的Unicode值。</p>
<p>该位置必须是0之间串。长度-1。如果位置超出范围，则 charCodeAt() 方法将返回一个特殊的非数字值，打印为 NaN。</p>
<ul>
<li>如果字符的 Unicode 值无法用单个 UTF-16 代码单元表示，请使用codePointAt() 方法。</li>
<li>charCodeAt() 方法不会更改原始<em>字符串</em>的值。</li>
</ul>
<h3 id="File"><a href="#File" class="headerlink" title="File"></a>File</h3><p><strong>File 对象继承自 Blob 对象，先看看 Blob 对象。</strong></p>
<p>Blob 对象表示一个不可变、原始数据的类文件对象。Blob 表示的不一定是JavaScript原生格式的数据。</p>
<p>我们接触的多数关于 File 的操作都是读取，js也为我们提供了手动创建 File 对象的构造函数：File(bits, name[, options])。</p>
<ul>
<li><code>bits (required)</code> ArrayBuffer，ArrayBufferView，Blob，或者 Array[string] —<br>或者任何这些对象的组合。这是 UTF-8 编码的文件内容。</li>
<li><code>name [String] (required)</code> 文件名称，或者文件路径.</li>
<li><code>options [Object] (optional) </code>选项对象，包含文件的可选属性。可用的选项如下：<br><code>type: string</code>, 表示将要放到文件中的内容的MIME类型。默认值为 ‘’ 。<br><code>lastModified</code>: 数值，表示文件最后修改时间的 Unix 时间戳（毫秒）。默认值为 Date.now()。</li>
</ul>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// base64图片转file的方法（base64图片, 设置生成file的文件名）</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">base64ToFile</span>(<span class="params">base64: <span class="built_in">any</span>, fileName: <span class="built_in">string</span></span>): <span class="title class_">File</span> &#123;</span><br><span class="line">  <span class="comment">// 将base64按照 , 进行分割 将前缀  与后续内容分隔开</span></span><br><span class="line">  <span class="keyword">let</span> data = base64.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">  <span class="comment">// 利用正则表达式 从前缀中获取图片的类型信息（image/png、image/jpeg、image/webp等）</span></span><br><span class="line">  <span class="keyword">let</span> <span class="keyword">type</span> = data[<span class="number">0</span>].<span class="title function_">match</span>(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>];</span><br><span class="line">  <span class="comment">// 从图片的类型信息中 获取具体的文件格式后缀（png、jpeg、webp）</span></span><br><span class="line">  <span class="keyword">let</span> suffix = <span class="keyword">type</span>.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">  <span class="comment">// 使用atob()对base64数据进行解码  结果是一个文件数据流 以字符串的格式输出</span></span><br><span class="line">  <span class="keyword">const</span> bstr = <span class="variable language_">window</span>.<span class="title function_">atob</span>(data[<span class="number">1</span>]);</span><br><span class="line">  <span class="comment">// 获取解码结果字符串的长度</span></span><br><span class="line">  <span class="keyword">let</span> n = bstr.<span class="property">length</span>;</span><br><span class="line">  <span class="comment">// 根据解码结果字符串的长度创建一个等长的整形数字数组</span></span><br><span class="line">  <span class="comment">// 但在创建时 所有元素初始值都为 0</span></span><br><span class="line">  <span class="keyword">const</span> u8arr = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(n);</span><br><span class="line">  <span class="comment">// 将整形数组的每个元素填充为解码结果字符串对应位置字符的UTF-16 编码单元</span></span><br><span class="line">  <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">    <span class="comment">// charCodeAt()：获取给定索引处字符对应的 UTF-16 代码单元</span></span><br><span class="line">    u8arr[n] = bstr.<span class="title function_">charCodeAt</span>(n);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 利用构造函数创建File文件对象</span></span><br><span class="line">  <span class="comment">// new File(bits, name, options)</span></span><br><span class="line">  <span class="keyword">const</span> file = <span class="keyword">new</span> <span class="title class_">File</span>([u8arr], <span class="string">`<span class="subst">$&#123;fileName&#125;</span>.<span class="subst">$&#123;suffix&#125;</span>`</span>, &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="keyword">type</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 将File文件对象返回给方法的调用者</span></span><br><span class="line">  <span class="keyword">return</span> file;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/04/base64%E8%BD%AC%E6%96%87%E4%BB%B6/" data-id="clh94rs560004o8gt7ghlbb9n" data-title="base64转文件" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Array includes的使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/04/Array%20includes%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2023-05-04T12:49:24.280Z" itemprop="datePublished">2023-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/04/Array%20includes%E7%9A%84%E4%BD%BF%E7%94%A8/">Array includes</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong><code>includes()</code></strong> 方法用来判断一个<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%95%B0%E7%BB%84&spm=1001.2101.3001.7020">数组</a>是否包含一个指定的值，根据情况，如果包含则返回 <code>true</code>，否则返回 <code>false</code>。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="title function_">includes</span>(searchElement) <span class="comment">// return true or false</span></span><br><span class="line">arr.<span class="title function_">includes</span>(searchElement, fromIndex) <span class="comment">// return true or false</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>searchElement</code>:需要查找的元素值</li>
<li><code>fromIndex</code>: <strong>选填</strong>。从<code>arr</code>的<code>fromIndex</code>的索引处开始查找。接受正负值，若为负值，则从<code>fromIndex+arr.length</code>索引处开始查找。默认为0。</li>
</ul>
<p>若<code>fromIndex</code>&gt;<code>arr.length</code>，即索引开始值大于等于数组长度。则将直接返回<code>false</code>，且不搜索该数组。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/04/Array%20includes%E7%9A%84%E4%BD%BF%E7%94%A8/" data-id="clh94rs4y0000o8gt72gx0l99" data-title="Array includes" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-音频可视化" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/04/%E9%9F%B3%E9%A2%91%E5%8F%AF%E8%A7%86%E5%8C%96/" class="article-date">
  <time class="dt-published" datetime="2023-05-04T12:49:24.277Z" itemprop="datePublished">2023-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/04/%E9%9F%B3%E9%A2%91%E5%8F%AF%E8%A7%86%E5%8C%96/">音频可视化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="用到的知识"><a href="#用到的知识" class="headerlink" title="用到的知识"></a>用到的知识</h2><h3 id="devicePixelRatio-设备像素比"><a href="#devicePixelRatio-设备像素比" class="headerlink" title="devicePixelRatio 设备像素比"></a>devicePixelRatio 设备像素比</h3><p>window.devicePixelRatio &#x3D; 物理像素 &#x2F; 逻辑像素<br>这里物理像素是指电脑分辨率，逻辑像素指的是如css像素</p>
<p>正常人眼可以识别的分辨率为 300PPI，而现在很多设备的分辨率都超过 300PPI，如果设备总是以满分辨率来显示东西就可能造成文字太小无法看清，因此像浏览器这样的软件就会对内容做一次放大后再进行渲染（也就是降低分辨率）：要降低分辨率就需要让像素这个单位变大，因此 PPI 的计算不再使用物理像素，而改用设备独立像素，那么设备独立像素和物理像素之间就存在一个比例差异，这就是 设备像素比。</p>
<h3 id="AudioContext音频上下文"><a href="#AudioContext音频上下文" class="headerlink" title="AudioContext音频上下文"></a>AudioContext音频上下文</h3><p>简洁来说就是使用这个API我们可以对音频进行各种操作，比如控制音量（简单的audio标签就可以进行控制音量，使用WebAudioAPI是对这个API的大材小用）、控制左右声道的播放，对音效进行优化，音频可视化（最常见的使用）。</p>
<p>音频上下文控制它包含的节点的创建和音频处理或解码的执行。在做任何其他操作之前，您需要创建一个<code>AudioContext</code>对象，因为所有事情都是在上下文中发生的。建议创建一个<code>AudioContext</code>对象并复用它，而不是每次初始化一个新的<code>AudioContext</code>对象，并且可以对多个不同的音频源和管道同时使用一个<code>AudioContext</code>对象。</p>
<h4 id="createMediaElementSource创建新对象"><a href="#createMediaElementSource创建新对象" class="headerlink" title="createMediaElementSource创建新对象"></a>createMediaElementSource创建新对象</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioContext"><code>AudioContext</code></a> 接口的 <code>createMediaElementSource()</code> 方法用于创建一个新的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaElementAudioSourceNode"><code>MediaElementAudioSourceNode</code></a> 对象，输入某个存在的 HTML <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/audio">&#96;&#96;</a> or <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/video">&#96;&#96;</a> 元素，对应的音频即可被播放或者修改。</p>
<h4 id="createAnalyser创建分析器对象"><a href="#createAnalyser创建分析器对象" class="headerlink" title="createAnalyser创建分析器对象"></a>createAnalyser创建分析器对象</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioContext"><code>AudioContext</code></a>的<code>createAnalyser()</code>方法能创建一个<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/AnalyserNode"><code>AnalyserNode</code></a>，可以用来获取音频时间和频率数据，以及实现数据可视化。</p>
<h5 id="AnalyserNode-ffSize"><a href="#AnalyserNode-ffSize" class="headerlink" title="AnalyserNode.ffSize"></a>AnalyserNode.ffSize</h5><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/AnalyserNode"><code>AnalyserNode</code></a> 接口的 <code>fftSize</code> 属性的值是一个无符号长整型的值，表示（信号）样本的窗口大小。当执行<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web">快速傅里叶变换</a>（Fast Fourier Transfor (FFT)）时，这些（信号）样本被用来获取频域数据。</p>
<p>fftSize 属性的值必须是从 32 到 32768 范围内的 2 的非零幂; 其默认值为 2048.</p>
<p>关于 fftSize ，在 MDN 上的介绍可能很难理解，说是快速傅里叶变换的一个参数。</p>
<p>可以从以下角度理解：</p>
<ol>
<li>它的取值是什么？</li>
</ol>
<p>fftSize 的要求是 2 的幂次方，比如 256 、 512 等。数字越大，得到的结果越精细。</p>
<p>对于移动端网页来说，本身音频的比特率大多是 128Kbps ，没有必要用太大的频率数组去存储本身就不够精细的源数据。另外，手机屏幕的尺寸比桌面端小，因此最终展示图形也不需要每个频率都采到。只需要体现节奏即可，因此 512 是较为合理的值。</p>
<ol start="2">
<li>它的作用是什么？</li>
</ol>
<p>fftSize 决定了 frequencyData 的长度，具体为 fftSize 的一半。</p>
<h5 id="AnalyserNode-frequencyBinCount"><a href="#AnalyserNode-frequencyBinCount" class="headerlink" title="AnalyserNode.frequencyBinCount"></a>AnalyserNode.frequencyBinCount</h5><p><strong><code>frequencyBinCount</code></strong> 的值固定为 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/AnalyserNode"><code>AnalyserNode</code></a> 接口中 fftSize 值的一半。该属性通常用于可视化的数据值的数量。</p>
<h5 id="AnalyserNode-getByteFrequencyData"><a href="#AnalyserNode-getByteFrequencyData" class="headerlink" title="AnalyserNode.getByteFrequencyData()"></a>AnalyserNode.getByteFrequencyData()</h5><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/AnalyserNode"><code>AnalyserNode</code></a>接口的 <strong><code>getByteFrequencyData()</code></strong> 方法将当前频率数据复制到传入的 Uint8Array（无符号字节数组）中。</p>
<p>如果数组的长度小于 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/AnalyserNode/frequencyBinCount"><code>AnalyserNode.frequencyBinCount</code></a>, 那么 Analyser 多出的元素会被删除。如果是大于，那么数组多余的元素会被忽略。</p>
<h4 id="AudioContext-destination标识音频尾节点"><a href="#AudioContext-destination标识音频尾节点" class="headerlink" title="AudioContext.destination标识音频尾节点"></a>AudioContext.destination标识音频尾节点</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioContext"><code>AudioContext</code></a>的 <code>destination</code> 属性返回一个 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioDestinationNode"><code>AudioDestinationNode</code></a>，表示 context 中所有音频的最终目标节点，一般是音频渲染设备，比如扬声器。</p>
<h3 id="requestAnimationFrame绘制函数"><a href="#requestAnimationFrame绘制函数" class="headerlink" title="requestAnimationFrame绘制函数"></a>requestAnimationFrame绘制函数</h3><p>window.requestAnimationFrame() 告诉浏览器——你希望执行一个动画，并且要求<strong>浏览器在下次重绘之前调用指定的回调函数更新动画</strong>。</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        *&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">min-height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#000</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">canvas</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">audio</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">top</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">right</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">opacity</span>: <span class="number">0.1s</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">transition</span>: opacity <span class="number">0.5s</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">audio</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">opacity</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">&quot;../aaa.m4a&quot;</span> <span class="attr">controls</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> audio = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;audio&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> cvs = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;canvas&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> ctx = cvs.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">initCvs</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            cvs.<span class="property">width</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> * devicePixelRatio</span></span><br><span class="line"><span class="language-javascript">            cvs.<span class="property">height</span> = (<span class="variable language_">window</span>.<span class="property">innerHeight</span> / <span class="number">2</span>) * devicePixelRatio</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">initCvs</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> isInit=<span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> dataArray</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> analyser</span></span><br><span class="line"><span class="language-javascript">        audio.<span class="property">onplay</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(isInit) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> audioCtx = <span class="keyword">new</span> <span class="title class_">AudioContext</span>()</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> source = audioCtx.<span class="title function_">createMediaElementSource</span>(audio)</span></span><br><span class="line"><span class="language-javascript">            analyser = audioCtx.<span class="title function_">createAnalyser</span>()</span></span><br><span class="line"><span class="language-javascript">            analyser.<span class="property">fftSize</span>=<span class="number">512</span></span></span><br><span class="line"><span class="language-javascript">            dataArray = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(analyser.<span class="property">frequencyBinCount</span>)</span></span><br><span class="line"><span class="language-javascript">            source.<span class="title function_">connect</span>(analyser)</span></span><br><span class="line"><span class="language-javascript">            analyser.<span class="title function_">connect</span>(audioCtx.<span class="property">destination</span>)</span></span><br><span class="line"><span class="language-javascript">            isInit=<span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">         <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">requestAnimationFrame</span>(draw)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> &#123;width,height&#125; = cvs</span></span><br><span class="line"><span class="language-javascript">            ctx.<span class="title function_">clearRect</span>(<span class="number">0</span>,<span class="number">0</span>,width,height)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(!isInit) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            analyser.<span class="title function_">getByteFrequencyData</span>(dataArray)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> len = dataArray.<span class="property">length</span> / <span class="number">2</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(len);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> barWidth = width / len</span></span><br><span class="line"><span class="language-javascript">            ctx.<span class="property">fillStyle</span>=<span class="string">&quot;#e0f9b5&quot;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i &lt; len;i++) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> data = dataArray[i]</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> barHeight=(data / <span class="number">255</span>) * height</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> x1 = i * barWidth + width / <span class="number">2</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> x2 = width / <span class="number">2</span> - (i + <span class="number">1</span>) * barWidth</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> y = height - barHeight</span></span><br><span class="line"><span class="language-javascript">                ctx.<span class="title function_">fillRect</span>(x1,y,barWidth - <span class="number">2</span>,barHeight)</span></span><br><span class="line"><span class="language-javascript">                ctx.<span class="title function_">fillRect</span>(x2,y,barWidth - <span class="number">2</span>,barHeight)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">        &#125;   </span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">draw</span>()</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39624705/article/details/111730192?ops_request_misc=&request_id=&biz_id=102&utm_term=AnalyserNode.fftSize&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-7-111730192.142%5Ev73%5Einsert_down1,201%5Ev4%5Eadd_ask,239%5Ev2%5Einsert_chatgpt&spm=1018.2226.3001.4187">csdn</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/04/%E9%9F%B3%E9%A2%91%E5%8F%AF%E8%A7%86%E5%8C%96/" data-id="clh94rs5a000ao8gt6y777u27" data-title="音频可视化" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-图片转base64" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/04/%E5%9B%BE%E7%89%87%E8%BD%ACbase64/" class="article-date">
  <time class="dt-published" datetime="2023-05-04T12:49:24.274Z" itemprop="datePublished">2023-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/04/%E5%9B%BE%E7%89%87%E8%BD%ACbase64/">图片转base64</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="所需知识"><a href="#所需知识" class="headerlink" title="所需知识"></a>所需知识</h2><h3 id="FileReader-异步读取文件"><a href="#FileReader-异步读取文件" class="headerlink" title="FileReader 异步读取文件"></a>FileReader 异步读取文件</h3><p><code>FileReader</code>提供了如下方法：</p>
<p><code>readAsArrayBuffer(file)</code>：按字节读取文件内容，结果用ArrayBuffer对象表示</p>
<p>readAsArrayBuffer方法读取文件后，会在内存中创建一个ArrayBuffer对象（二进制缓冲区），将二进制数据存放在其中。通过此方式，可以直接在网络中传输二进制内容。</p>
<p><code>readAsBinaryString(file)</code>：按字节读取文件内容，结果为文件的二进制串</p>
<p><code>readAsDataURL(file)</code>：读取文件内容，结果用data:url的字符串形式表示</p>
<p>readAsDataURL 方法会读取指定的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob">Blob</a> 或 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/File">File</a> 对象。并生成<code>data URl(base64编码)。</code></p>
<p><code>readAsText(file,encoding)</code>：按字符读取文件内容，结果用字符串形式表示</p>
<p><code>abort()</code>：终止文件读取操作</p>
<p>FileReader事件：</p>
<p><code>onloadstart</code>：读取文件开始时触发<br><code>onprogress</code>：读取过程中触发，会返还本次读取文件的最大字节数和已经读取完毕的字节数，可以用来做进度条<br><code>onabort</code>：在读取中断时触发<br><code>onerror</code>：在读取文件失败时触发<br><code>onload</code>：在读取完成时触发<br><code>onloadend</code>：读取结束后触发，不论成功还是失败都会触发，触发时机在onload之后</p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RcFile</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd/es/upload&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 转base64编码</span></span><br><span class="line"><span class="keyword">const</span> getBase64 = (<span class="attr">file</span>: <span class="title class_">RcFile</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt; =&gt;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">    reader.<span class="title function_">readAsDataURL</span>(file);</span><br><span class="line">    reader.<span class="property">onload</span> = <span class="function">() =&gt;</span> <span class="title function_">resolve</span>(reader.<span class="property">result</span> <span class="keyword">as</span> <span class="built_in">string</span>);</span><br><span class="line">    reader.<span class="property">onerror</span> = <span class="function">(<span class="params">error</span>) =&gt;</span> <span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getBase64;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/04/%E5%9B%BE%E7%89%87%E8%BD%ACbase64/" data-id="clh94rs5c000bo8gt6x358ha9" data-title="图片转base64" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-图片懒加载" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/04/%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD/" class="article-date">
  <time class="dt-published" datetime="2023-05-04T12:49:24.269Z" itemprop="datePublished">2023-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/04/%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD/">图片懒加载</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="所需知识"><a href="#所需知识" class="headerlink" title="所需知识"></a>所需知识</h2><h3 id="IntersectionObserver"><a href="#IntersectionObserver" class="headerlink" title="IntersectionObserver"></a>IntersectionObserver</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> io = <span class="keyword">new</span> IntersectionObserver(callback, options)</span><br></pre></td></tr></table></figure>

<p>以上代码会返回一个<code>IntersectionObserver</code>实例，<code>callback</code>是当元素的可见性变化时候的回调函数，<code>options</code>是一些配置项（可选）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">io.<span class="title function_">observe</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;img&#x27;</span>))  开始观察，接受一个<span class="variable constant_">DOM</span>节点对象</span><br><span class="line">io.<span class="title function_">unobserve</span>(element)   停止观察 接受一个element元素</span><br><span class="line">io.<span class="title function_">disconnect</span>() 关闭观察器</span><br></pre></td></tr></table></figure>

<h4 id="options"><a href="#options" class="headerlink" title="options"></a>options</h4><p><strong>root</strong></p>
<p>用于观察的根元素，默认是浏览器的视口，也可以指定具体元素，指定元素的时候用于观察的元素必须是指定元素的子元素</p>
<p><strong>threshold</strong></p>
<p>用来指定交叉比例，决定什么时候触发回调函数，是一个数组，默认是<code>[0]</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">    <span class="attr">root</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">threshold</span>: [<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> io = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(callback, options)</span><br><span class="line">io.<span class="title function_">observe</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;img&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><strong>rootMargin</strong></p>
<p>用来扩大或者缩小视窗的的大小，使用css的定义方法，<code>10px 10px 30px 20px</code>表示top、right、bottom 和 left的值</p>
<h4 id="callback"><a href="#callback" class="headerlink" title="callback"></a>callback</h4><p>callback函数会触发两次，元素进入视窗（开始可见时）和元素离开视窗（开始不可见时）都会触发</p>
<p>callback函数有个<code>entries</code>参数，它是个<code>IntersectionObserverEntry</code>对象数组</p>
<p>每个对象有这些参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">boundingClientRect  目标元素的矩形信息</span><br><span class="line"> intersectionRatio   相交区域和目标元素的比例值   intersectionRect/boundingClientRect 不可见时小于等于0</span><br><span class="line"> intersectionRect    目标元素和视窗（根）相交的矩形信息 可以称为相交区域</span><br><span class="line"> isIntersecting      目标元素当前是否可见 Boolean值 可见为true</span><br><span class="line"> rootBounds              根元素的矩形信息，没有指定根元素就是当前视窗的矩形信息</span><br><span class="line"> target                      观察的目标元素</span><br><span class="line"> time                返回一个记录从`IntersectionObserver`的时间到交叉被触发的时间的时间戳</span><br></pre></td></tr></table></figure>

<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useEffect, useRef &#125; from &quot;react&quot;</span><br><span class="line"></span><br><span class="line">const Lazy = (&#123;src,alt&#125;)=&gt;&#123;</span><br><span class="line">  const imgref = useRef()</span><br><span class="line">  const io = new IntersectionObserver((entries)=&gt;&#123;</span><br><span class="line">    entries.forEach(item=&gt;&#123;</span><br><span class="line">      console.log(item);</span><br><span class="line">      if(item.isIntersecting) &#123;</span><br><span class="line">        item.target.src = item.target.dataset.src</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    root: null,</span><br><span class="line">    threshold: 0</span><br><span class="line">  &#125;)</span><br><span class="line">  useEffect(()=&gt;&#123;</span><br><span class="line">    io.observe(imgref.current)</span><br><span class="line">  &#125;,[])</span><br><span class="line">  return &lt;img src=&quot;&quot; data-src=&#123;src&#125; alt=&#123;alt&#125; ref=&#123;imgref&#125; /&gt;</span><br><span class="line">&#125;</span><br><span class="line">export default Lazy</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/04/%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD/" data-id="clh94rs5d000co8gta0tb2a05" data-title="图片懒加载" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/05/04/%E5%87%BD%E6%95%B0%E9%98%B2%E6%8A%96%E4%B8%8E%E5%87%BD%E6%95%B0%E8%8A%82%E6%B5%81/">函数防抖与函数节流</a>
          </li>
        
          <li>
            <a href="/2023/05/04/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E9%97%AD%E5%8C%85%E7%9A%84%E7%90%86%E8%A7%A3/">关于函数闭包的理解</a>
          </li>
        
          <li>
            <a href="/2023/05/04/js%E5%BC%80%E5%90%AF%E6%91%84%E5%83%8F%E5%A4%B4/">js开启摄像头</a>
          </li>
        
          <li>
            <a href="/2023/05/04/JS%20Set%E4%BD%BF%E7%94%A8/">JS Set使用</a>
          </li>
        
          <li>
            <a href="/2023/05/04/call,bind,apply/">call,bind,apply</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 xiyueyezibile<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>